<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Central Hub ‚Äî Welcome</title>
<style>
  /* -------------------------
     Zen Colors & base layout
     ------------------------- */
  :root{
    --zen-bg-1: #ffe6f2;
    --zen-bg-2: #fff0f6;
    --card-bg: rgba(255, 246, 250, 0.65);
    --text-dark: #a14a76;
    --text-muted: #c77fa7;
    --accent-1: #ffb7d5;
    --accent-2: #ff6f91;
    --border: rgba(255, 183, 213, 0.5);
    --shadow: 0 4px 20px rgba(255, 111, 145, 0.08);
    --petal: #ffb7d5;
    --petal-dark: #ff6f91;
  }
  .dark{
    --zen-bg-1: #2d1a2c;
    --zen-bg-2: #4a274a;
    --card-bg: rgba(58, 31, 61, 0.65);
    --text-dark: #ffe6f2;
    --text-muted: #ffb7d5;
    --accent-1: #ff6f91;
    --accent-2: #a14a76;
    --border: rgba(255, 183, 213, 0.18);
    --shadow: 0 4px 20px rgba(255, 111, 145, 0.18);
    --petal: #ff6f91;
    --petal-dark: #a14a76;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    margin:0; min-height:100vh; min-width:100vw; overflow-x:hidden; overflow-y:auto;
    display:block;
    background: linear-gradient(120deg, var(--zen-bg-1) 0%, var(--zen-bg-2) 40%, var(--accent-1) 100%);
    background-size: 200% 200%;
    animation: sakuraGradientMove 16s ease-in-out infinite alternate;
    transition: background 700ms ease, color 400ms ease;
    color:var(--text-dark);
    position:relative;
  }

  @keyframes sakuraGradientMove {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }

  /* Mouse trail particles */
  .trail-particle {
    position: fixed;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--accent-1), var(--accent-2));
    pointer-events: none;
    z-index: 9998;
    opacity: 0.8;
    animation: trailFade 1.2s ease-out forwards;
    will-change: transform, opacity;
  }
  
  @keyframes trailFade {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(0.2); opacity: 0; }
  }

  /* Sakura petals floating */
  .sakura-petal {
    position: absolute;
    width: 32px;
    height: 32px;
    pointer-events: none;
    z-index: 1;
    opacity: 0.7;
    animation: petalFloat 12s linear infinite;
    will-change: transform;
  }
  @keyframes petalFloat {
    0% { transform: translateY(-40px) rotate(0deg) scale(1); opacity:0.7; }
    50% { transform: translateY(60vh) rotate(40deg) scale(1.1); opacity:0.9; }
    100% { transform: translateY(100vh) rotate(80deg) scale(0.9); opacity:0.3; }
  }

  /* Offline indicator */
  .offline-badge {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    background: rgba(255, 107, 107, 0.95);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.3s, transform 0.3s;
    pointer-events: none;
  }
  
  .offline-badge.show {
    opacity: 1;
    transform: translateY(0);
  }

  /* -------------------------
     ENTRY overlay / layout (fullscreen)
     ------------------------- */
  #entryOverlay{
    position:fixed; inset:0; z-index:4000;
    display:flex; align-items:center; justify-content:center; pointer-events:auto;
    background: linear-gradient(135deg, #2d1a2c 0%, #4a274a 25%, #3a1f3d 50%, #2d1a2c 75%, #1a1a2e 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
  }
  
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  #entryInner{
    display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; color:#e8eef3;
    pointer-events:auto;
  }

  #entryTitle{
    font-size:1.8rem; font-weight:300; opacity:0; transform: translateY(6px);
    transition: opacity 420ms ease, transform 420ms ease;
    letter-spacing: -0.5px;
  }
  #entrySub{
    margin-top:4px; color:#cbd5e0; opacity:0; transform: translateY(6px);
    transition: opacity 420ms ease 120ms, transform 420ms ease 120ms;
    font-size:1.05rem;
  }

  /* Three container (rounded) */
  #threeWrap{ width:480px; height:480px; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
  #threeContainer{ width:100%; height:100%; border-radius:50%; overflow:visible; }

  /* main app (hidden until reveal) */
  .app { 
    width:100%; max-width:1000px; position:relative; z-index:10; 
    opacity:0; transform:translateY(12px); 
    transition:opacity 600ms ease, transform 500ms ease; 
    pointer-events:none; padding:32px 18px 18px 18px; box-sizing:border-box; 
    margin:0 auto;
    min-height:calc(100vh - 32px);
    background:transparent;
    overflow:visible;
    display:block;
  }
  .app.visible{ opacity:1; transform:translateY(0); pointer-events:auto; }

  header{ 
    display:flex; align-items:center; justify-content:space-between; 
    margin-bottom:40px; flex-wrap:wrap; gap:16px; position:relative; 
    margin-top:12px;
    background: var(--card-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 24px;
    box-shadow: var(--shadow);
  }
  
  .title-wrap{ display:flex; gap:18px; align-items:center; }
  .logo-zen {
    width:56px;height:56px;border-radius:16px;
    background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:2.1rem;box-shadow:0 4px 16px rgba(255,111,145,0.18);
    letter-spacing:2px;
    border:2px solid #fff2;
    margin-right:2px;
    animation: logoPulse 2.5s infinite alternate;
    position:relative;
    overflow:visible;
    will-change: box-shadow;
  }
  .logo-zen::after {
    content: '';
    position: absolute;
    right: -12px; top: -10px;
    width: 22px; height: 22px;
    background: url('data:image/svg+xml;utf8,<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="11" cy="11" rx="10" ry="6" fill="%23ffb7d5"/><ellipse cx="11" cy="11" rx="6" ry="10" fill="%23ff6f91" opacity="0.5"/></svg>');
    opacity:0.7;
    z-index:2;
  }
  @keyframes logoPulse {
    0% { box-shadow:0 4px 16px rgba(255,111,145,0.18); }
    100% { box-shadow:0 8px 32px rgba(255,183,213,0.28); }
  }
  h1{ font-size:2.2rem; color:var(--text-dark); margin:0; font-weight:400; letter-spacing:-0.5px; }
  .subtitle{ color:var(--text-muted); font-size:1.15rem; margin-top:4px; font-weight:400; letter-spacing:0.2px; }
  .tagline { color:var(--accent-2); font-size:1.05rem; font-weight:500; margin-top:2px; letter-spacing:0.5px; }

  .controls{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .search{ 
    display:flex; gap:8px; align-items:center; border-radius:10px; 
    padding:10px 14px; border:1px solid var(--border); 
    background:var(--card-bg); 
    box-shadow:var(--shadow);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    transition: all 0.3s ease;
  }
  
  .search:focus-within {
    border-color: var(--accent-1);
    box-shadow: 0 0 0 3px rgba(255, 183, 213, 0.2);
    transform: scale(1.02);
  }
  
  .search input{ 
    border:0; outline:0; background:transparent; 
    color:var(--text-dark); width:260px; font-size:1rem;
  }
  .search input::placeholder{ color:var(--text-muted); }

  .btn{
    padding:10px 14px; border-radius:10px; cursor:pointer; 
    font-weight:600; border:1px solid var(--border);
    background:var(--card-bg); color:var(--text-dark);
    transition:all 0.3s cubic-bezier(.4,0,.2,1);
    box-shadow:0 2px 8px rgba(255,111,145,0.08);
    position:relative;
    overflow:hidden;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    will-change: transform;
  }
  
  .btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  
  .btn.ripple::after {
    width: 300px;
    height: 300px;
  }
  
  .btn:hover{
    transform:translateY(-2px) scale(1.04);
    box-shadow:0 12px 32px rgba(255,111,145,0.22);
    background:linear-gradient(135deg, var(--accent-1) 60%, var(--accent-2) 100%);
    color:white;
  }

  .grid{ 
    display:grid; 
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
    gap:30px; 
  }
  
  .card{ 
    background:var(--card-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius:20px; 
    padding:54px 38px; 
    text-align:center; 
    border:1px solid var(--border); 
    box-shadow:0 8px 32px rgba(255,111,145,0.10); 
    transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
    display:flex; 
    flex-direction:column; 
    align-items:center;
    justify-content:center; 
    min-height:220px; 
    cursor:pointer;
    position:relative;
    overflow:hidden;
    will-change: transform;
  }
  .card::after {
    content: '';
    position: absolute;
    left: 12px; bottom: 10px;
    width: 28px; height: 28px;
    background: url('data:image/svg+xml;utf8,<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="14" cy="14" rx="13" ry="7" fill="%23ffb7d5"/><ellipse cx="14" cy="14" rx="7" ry="13" fill="%23ff6f91" opacity="0.5"/></svg>');
    opacity:0.5;
    z-index:0;
  }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .card:hover{ 
    transform:translateY(-10px) scale(1.03); 
    box-shadow:0 32px 64px rgba(102,126,234,0.18); 
    border-color:rgba(102, 126, 234, 0.38);
    background:linear-gradient(120deg, var(--accent-1) 10%, var(--card-bg) 90%);
  }
  
  .card:hover::before {
    transform: scaleX(1);
  }

  .card-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 25px;
    background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .card:hover .card-icon {
    transform: scale(1.1) rotate(5deg);
  }

  .card-icon svg {
    width: 32px;
    height: 32px;
    stroke: white;
    stroke-width: 2;
    fill: none;
  }

  .card-title{ 
    font-weight:700; 
    color:var(--accent-2); 
    font-size:1.6em; 
    margin-bottom:12px;
    letter-spacing:-0.3px;
    text-shadow:0 2px 8px rgba(255,111,145,0.08);
  }
  .card-desc{ 
    color:var(--text-muted); 
    font-size:1.08em; 
    line-height:1.7;
    margin-bottom:8px;
  }

  .add-card{ 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    min-height:200px; 
    border-radius:16px; 
    background:linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); 
    border:2px dashed var(--border); 
    font-size:3rem; 
    color:var(--text-muted); 
    cursor:pointer;
    transition:all 0.3s ease;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .add-card:hover{
    background:linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-color:var(--accent-1);
    color:var(--accent-1);
    transform:scale(1.02);
  }

  /* modal */
  .modal{ 
    position:fixed; inset:0; display:flex; 
    align-items:center; justify-content:center; 
    z-index:5000; 
    background:rgba(0,0,0,0.4); 
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    opacity:0; pointer-events:none; 
    transition:opacity 300ms; 
  }
  .modal.show{ opacity:1; pointer-events:auto; }
  
  .modal-card{ 
    width:100%; max-width:520px; 
    background:var(--card-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius:20px; 
    padding:40px; 
    border:1px solid var(--border); 
    box-shadow:0 20px 60px rgba(0,0,0,0.2);
    animation: slideUp 0.3s ease;
  }
  
  .modal-card h3{
    font-size:1.8em;
    color:var(--text-dark);
    margin-bottom:30px;
    font-weight:600;
  }
  
  .form-group{
    margin-bottom:25px;
  }
  
  .form-group label{
    display:block;
    color:var(--text-dark);
    font-size:0.95em;
    margin-bottom:8px;
    font-weight:500;
  }
  
  .form-group input,
  .form-group textarea{
    width:100%;
    padding:12px 16px;
    border:2px solid var(--border);
    border-radius:10px;
    font-size:1em;
    transition:all 0.3s ease;
    font-family:inherit;
    background:var(--card-bg);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color:var(--text-dark);
  }
  
  .form-group input:focus,
  .form-group textarea:focus{
    outline:none;
    border-color:var(--accent-1);
    box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .form-group textarea{
    resize:vertical;
    min-height:80px;
  }
  
  .modal-actions{ 
    display:flex; 
    gap:15px; 
    margin-top:30px; 
  }
  
  .btn-primary{ 
    flex:1;
    background:linear-gradient(135deg, var(--accent-1), var(--accent-2)); 
    color:white;
    border:none;
  }
  
  .btn-primary:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(102, 126, 234, 0.3);
  }
  
  .btn-secondary{
    flex:1;
    background:var(--card-bg);
    color:var(--text-dark);
  }

  /* Updates Modal */
  .updates-modal {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 6000;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 400ms ease;
  }
  
  .updates-modal.show {
    opacity: 1;
    pointer-events: auto;
  }
  
  .updates-content {
    width: 90%;
    max-width: 600px;
    background: var(--card-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 48px;
    border: 1px solid var(--border);
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.4s ease;
    max-height: 85vh;
    overflow-y: auto;
  }
  
  .updates-header {
    text-align: center;
    margin-bottom: 32px;
  }
  
  .updates-header h2 {
    font-size: 2.2em;
    color: var(--text-dark);
    margin-bottom: 8px;
    font-weight: 700;
  }
  
  .updates-header .version {
    color: var(--accent-2);
    font-size: 1.1em;
    font-weight: 600;
  }
  
  .feature-list {
    list-style: none;
    padding: 0;
    margin: 24px 0;
  }
  
  .feature-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    margin-bottom: 16px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
  }
  
  .feature-item:hover {
    transform: translateX(8px);
    background: rgba(255, 255, 255, 0.5);
  }
  
  .feature-icon {
    font-size: 1.8em;
    flex-shrink: 0;
  }
  
  .feature-content h4 {
    color: var(--accent-2);
    font-size: 1.2em;
    margin-bottom: 4px;
  }
  
  .feature-content p {
    color: var(--text-muted);
    font-size: 0.95em;
    line-height: 1.5;
  }
  
  .updates-footer {
    text-align: center;
    margin-top: 32px;
  }
  
  .btn-explore {
    padding: 14px 40px;
    font-size: 1.1em;
    background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(255, 111, 145, 0.3);
  }
  
  .btn-explore:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(255, 111, 145, 0.4);
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* responsive */
  @media (max-width:860px){
    #threeWrap{ width:360px; height:360px; }
    .search input{ width:160px; }
    .grid{ gap:20px; }
    h1{ font-size:1.5rem; }
    .card{ padding:40px 25px; }
    header { padding: 18px; }
    .updates-content { padding: 32px 24px; }
  }
</style>
</head>
<body>
  <!-- Offline indicator -->
  <div class="offline-badge" id="offlineBadge">üì° Offline Mode</div>

  <!-- ENTRY overlay -->
  <div id="entryOverlay" role="dialog" aria-modal="true" aria-label="Entry overlay" tabindex="0">
    <div id="entryInner">
      <div id="threeWrap"><div id="threeContainer" aria-hidden="true"></div></div>
      <div id="entryTitle">Welcome Babies</div>
      <div id="entrySub">Enter</div>
    </div>
  </div>

  <!-- Main app -->
  <div class="app" id="appRoot" aria-hidden="true">
    <!-- Sakura petals -->
    <div class="sakura-petal" style="left:8vw;top:-32px;animation-delay:0s;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><ellipse cx="16" cy="16" rx="15" ry="8" fill="#ffb7d5"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="#ff6f91" opacity="0.5"/></svg></div>
    <div class="sakura-petal" style="left:22vw;top:-32px;animation-delay:2s;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><ellipse cx="16" cy="16" rx="15" ry="8" fill="#ffb7d5"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="#ff6f91" opacity="0.5"/></svg></div>
    <div class="sakura-petal" style="left:38vw;top:-32px;animation-delay:4s;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><ellipse cx="16" cy="16" rx="15" ry="8" fill="#ffb7d5"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="#ff6f91" opacity="0.5"/></svg></div>
    <div class="sakura-petal" style="left:60vw;top:-32px;animation-delay:1.5s;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><ellipse cx="16" cy="16" rx="15" ry="8" fill="#ffb7d5"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="#ff6f91" opacity="0.5"/></svg></div>
    <div class="sakura-petal" style="left:80vw;top:-32px;animation-delay:3.2s;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><ellipse cx="16" cy="16" rx="15" ry="8" fill="#ffb7d5"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="#ff6f91" opacity="0.5"/></svg></div>
    <header>
      <div class="title-wrap">
        <div class="logo-zen">Z</div>
        <div>
          <h1>Welcome Home</h1>
          <div class="subtitle">Choose your destination, Babies</div>
          <div class="tagline">Sakura Hub: Productivity Re-defined</div>
        </div>
      </div>
      <div class="controls">
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/>
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <input id="searchInput" placeholder="Search..." aria-label="Search categories">
        </div>
        <button id="openAdd" class="btn" title="Add category">+</button>
        <button id="exportBtn" class="btn" title="Export data">üíæ</button>
        <button id="themeToggle" class="btn" title="Toggle theme">üåô</button>
      </div>
    </header>

    <main>
      <section>
        <div id="cardGrid" class="grid" aria-live="polite">
          <!-- cards will be inserted here -->
        </div>
      </section>
    </main>
    <footer style="width:100%;text-align:center;margin-top:38px;color:var(--text-muted);font-size:1.08em;letter-spacing:0.2px;">
      <hr style="border:none;border-top:1px solid var(--border);margin:18px 0 12px 0;">
      <span>"Dreams and reality, separated only by will."</span>
    </footer>
  </div>

  <!-- Add Category modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Add Category</h3>
      <div class="form-group">
        <label>Title</label>
        <input id="cardTitle" type="text" placeholder="e.g., Projects" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="cardDesc" placeholder="Brief description" required></textarea>
      </div>
      <div class="form-group">
        <label>URL</label>
        <input id="cardUrl" type="url" placeholder="https://example.com" required>
      </div>
      <div class="modal-actions">
        <button id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button id="modalSave" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Updates Modal -->
  <div id="updatesModal" class="updates-modal" aria-hidden="true">
    <div class="updates-content" role="dialog" aria-modal="true" aria-labelledby="updatesTitle">
      <div class="updates-header">
        <h2 id="updatesTitle">‚ú® What's New</h2>
        <div class="version">Version 2.0 - Enhanced Edition</div>
      </div>
      
      <ul class="feature-list">
        <li class="feature-item">
          <div class="feature-icon">üé®</div>
          <div class="feature-content">
            <h4>Improved UI</h4>
            <p>Fixed the bug that caused white screens when loading in</p>
          </div>
        </li>
        <li class="feature-item">
          <div class="feature-icon">üåê</div>
          <div class="feature-content">
            <h4>Full Offline Support</h4>
            <p>Data now saves when you leave, even if you go offline</p>
          </div>
        </li>
        <li class="feature-item">
          <div class="feature-icon">üé≠</div>
          <div class="feature-content">
            <h4>Enhanced Visual Effects</h4>
            <p>Mouse trails, plus smoother scrolling for pc use</p>
          </div>
        </li>
        <li class="feature-item">
          <div class="feature-icon">üíæ</div>
          <div class="feature-content">
            <h4>Data Export Feature</h4>
            <p>Backup all your data once in a while </p>
          </div>
        </li>
        <li class="feature-item">
          <div class="feature-icon">‚ö°</div>
          <div class="feature-content">
            <h4>Minor Performance Improvements</h4>
            <p>Optimized animations, efficient particle system, and smoother interactions</p>
          </div>
        </li>
      </ul>
      
      <div class="updates-footer">
        <button id="closeUpdates" class="btn-explore">Got it, let's explore!</button>
      </div>
    </div>
  </div>

  <!-- soft chime -->
  <audio id="chimeAudio" preload="auto">
    <source src="data:audio/wav;base64,UklGRlQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQgAAAA=" type="audio/wav">
  </audio>

  <!-- three.js CDN (using r128 for stability) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
/* ============================================================
   Zen Hub Enhanced with IndexedDB & Modern Effects
   ============================================================ */

/* ---------- DOM references ---------- */
const entryOverlay = document.getElementById('entryOverlay');
const entryTitle = document.getElementById('entryTitle');
const entrySub = document.getElementById('entrySub');
const threeContainer = document.getElementById('threeContainer');
const appRoot = document.getElementById('appRoot');
const chime = document.getElementById('chimeAudio');
const offlineBadge = document.getElementById('offlineBadge');

const cardGrid = document.getElementById('cardGrid');
const openAdd = document.getElementById('openAdd');
const exportBtn = document.getElementById('exportBtn');
const modal = document.getElementById('modal');
const modalSave = document.getElementById('modalSave');
const modalCancel = document.getElementById('modalCancel');
const cardTitle = document.getElementById('cardTitle');
const cardDesc = document.getElementById('cardDesc');
const cardUrl = document.getElementById('cardUrl');
const searchInput = document.getElementById('searchInput');
const themeToggle = document.getElementById('themeToggle');

const updatesModal = document.getElementById('updatesModal');
const closeUpdates = document.getElementById('closeUpdates');

const STORAGE_KEY = 'zen_hub_categories';
const SETTINGS_KEY = 'zen_hub_settings';
const UPDATES_SEEN_KEY = 'zen_hub_updates_v2_seen';
const DB_NAME = 'ZenHubDB';
const DB_VERSION = 1;
const STORE_NAME = 'categories';

let db = null;
let useLocalStorage = false;

/* ---------- IndexedDB Setup ---------- */
async function initDB() {
  return new Promise((resolve, reject) => {
    if (!window.indexedDB) {
      console.warn('IndexedDB not supported, falling back to localStorage');
      useLocalStorage = true;
      resolve(null);
      return;
    }

    const request = indexedDB.open(DB_NAME, DB_VERSION);
    
    request.onerror = () => {
      console.warn('IndexedDB failed, using localStorage');
      useLocalStorage = true;
      resolve(null);
    };
    
    request.onsuccess = (e) => {
      db = e.target.result;
      resolve(db);
    };
    
    request.onupgradeneeded = (e) => {
      const database = e.target.result;
      if (!database.objectStoreNames.contains(STORE_NAME)) {
        const objectStore = database.createObjectStore(STORE_NAME, { keyPath: 'id' });
        objectStore.createIndex('title', 'title', { unique: false });
      }
    };
  });
}

async function saveToIndexedDB(categories) {
  if (useLocalStorage || !db) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(categories));
    return;
  }

  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readwrite');
    const objectStore = transaction.objectStore(STORE_NAME);
    
    // Clear existing
    objectStore.clear();
    
    // Add all categories
    categories.forEach(cat => {
      objectStore.add(cat);
    });
    
    transaction.oncomplete = () => resolve();
    transaction.onerror = () => {
      console.warn('IndexedDB write failed, falling back');
      useLocalStorage = true;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(categories));
      resolve();
    };
  });
}

async function loadFromIndexedDB() {
  if (useLocalStorage || !db) {
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : null;
  }

  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readonly');
    const objectStore = transaction.objectStore(STORE_NAME);
    const request = objectStore.getAll();
    
    request.onsuccess = () => {
      const results = request.result;
      resolve(results.length > 0 ? results : null);
    };
    
    request.onerror = () => {
      console.warn('IndexedDB read failed, trying localStorage');
      const data = localStorage.getItem(STORAGE_KEY);
      resolve(data ? JSON.parse(data) : null);
    };
  });
}

/* ---------- Offline Detection ---------- */
function updateOnlineStatus() {
  if (!navigator.onLine) {
    offlineBadge.classList.add('show');
  } else {
    offlineBadge.classList.remove('show');
  }
}

window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();

/* ---------- Mouse Trail Effect ---------- */
let lastTrailTime = 0;
const trailThrottle = 50; // ms

document.addEventListener('mousemove', (e) => {
  const now = Date.now();
  if (now - lastTrailTime < trailThrottle) return;
  lastTrailTime = now;
  
  const trail = document.createElement('div');
  trail.className = 'trail-particle';
  trail.style.left = e.clientX + 'px';
  trail.style.top = e.clientY + 'px';
  document.body.appendChild(trail);
  
  setTimeout(() => trail.remove(), 1200);
});

/* ---------- Ripple Effect on Buttons ---------- */
function addRippleEffect(button) {
  button.addEventListener('click', function(e) {
    this.classList.add('ripple');
    setTimeout(() => this.classList.remove('ripple'), 600);
  });
}

// Apply to all buttons
document.querySelectorAll('.btn').forEach(btn => addRippleEffect(btn));

/* ---------- text fade sequence ---------- */
function fadeInTextSequence(){
  setTimeout(()=>{ entryTitle.style.opacity = '1'; entryTitle.style.transform = 'translateY(0)'; }, 500);
  setTimeout(()=>{ entrySub.style.opacity = '1'; entrySub.style.transform = 'translateY(0)'; }, 900);
}
fadeInTextSequence();

/* ======================
   THREE.JS SAKURA ORB (Magical Petal Edition)
   ====================== */
let scene, camera, renderer, geometry, material, points, glowMesh, coreLight, orbitalRings;
let particleCount = 3500;
let positions, basePositions, sizes, velocities, colors, rotations, petalAngles;
let t = 0;
let mouse = {x:0,y:0}, mouseVelocity = {x:0, y:0}, prevMouse = {x:0, y:0};
let rotationTarget = {x:0,y:0}, rotationVelocity = {x:0, y:0};
let pulse = 0;
let rafID;
let breathingStarted = false;
let parallax = 0;
let currentDarkMode = false;

function initOrb(){
  scene = new THREE.Scene();
  const W = threeContainer.clientWidth || 480;
  const H = threeContainer.clientHeight || 480;
  camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 3000);
  camera.position.z = 420;

  renderer = new THREE.WebGLRenderer({ alpha:true, antialias:true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(W,H);
  renderer.domElement.style.display = 'block';
  threeContainer.appendChild(renderer.domElement);

  // Inner core glow (bright center)
  const coreGeometry = new THREE.SphereGeometry(40, 32, 32);
  const coreMaterial = new THREE.MeshBasicMaterial({
    color: 0xffdbeb,
    transparent: true,
    opacity: 0.6,
  });
  coreLight = new THREE.Mesh(coreGeometry, coreMaterial);
  scene.add(coreLight);

  // Outer glow sphere
  const glowGeometry = new THREE.SphereGeometry(165, 32, 32);
  const glowMaterial = new THREE.MeshBasicMaterial({
    color: 0xffb7d5,
    transparent: true,
    opacity: 0.06,
    side: THREE.BackSide
  });
  glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
  scene.add(glowMesh);

  // Create orbital rings
  orbitalRings = [];
  for(let r = 0; r < 3; r++) {
    const ringGeometry = new THREE.TorusGeometry(100 + r * 25, 0.5, 16, 100);
    const ringMaterial = new THREE.MeshBasicMaterial({
      color: 0xffb7d5,
      transparent: true,
      opacity: 0.15,
    });
    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
    ring.rotation.x = Math.PI / 2 + (r * 0.3);
    ring.rotation.y = r * 0.5;
    orbitalRings.push(ring);
    scene.add(ring);
  }

  // Sakura petal particles
  geometry = new THREE.BufferGeometry();
  positions = new Float32Array(particleCount*3);
  basePositions = new Float32Array(particleCount*3);
  sizes = new Float32Array(particleCount);
  velocities = new Float32Array(particleCount*3);
  colors = new Float32Array(particleCount*3);
  rotations = new Float32Array(particleCount);
  petalAngles = new Float32Array(particleCount);

  // Create depth layers
  for(let i=0;i<particleCount;i++){
    const u = Math.random(), v = Math.random();
    const theta = 2*Math.PI*u, phi = Math.acos(2*v - 1);
    
    // Multiple layers for depth
    const layerDepth = Math.floor(Math.random() * 3);
    const r = 140 + layerDepth * 15 + (Math.random()-0.5) * 5;
    
    const x = r * Math.sin(phi) * Math.cos(theta);
    const y = r * Math.sin(phi) * Math.sin(theta);
    const z = r * Math.cos(phi);
    basePositions[3*i] = x; basePositions[3*i+1] = y; basePositions[3*i+2] = z;
    positions[3*i] = x; positions[3*i+1] = y; positions[3*i+2] = z;
    velocities[3*i] = 0; velocities[3*i+1] = 0; velocities[3*i+2] = 0;
    
    // Vary sizes based on depth
    sizes[i] = 3 + (2 - layerDepth) * 1.5 + Math.random()*2;
    
    // Random rotation for each petal
    petalAngles[i] = Math.random() * Math.PI * 2;
    rotations[i] = (Math.random() - 0.5) * 0.02;
    
    // Beautiful sakura gradient colors
    const colorVar = Math.random();
    if(colorVar > 0.75) {
      // Bright white-pink
      colors[3*i] = 1.0; colors[3*i+1] = 0.95; colors[3*i+2] = 0.97;
    } else if(colorVar > 0.5) {
      // Light sakura pink
      colors[3*i] = 1.0; colors[3*i+1] = 0.82; colors[3*i+2] = 0.9;
    } else if(colorVar > 0.25) {
      // Medium pink
      colors[3*i] = 1.0; colors[3*i+1] = 0.65; colors[3*i+2] = 0.8;
    } else {
      // Deep rose
      colors[3*i] = 1.0; colors[3*i+1] = 0.44; colors[3*i+2] = 0.57;
    }
  }

  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  geometry.setAttribute('aSize', new THREE.BufferAttribute(sizes, 1));
  geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

  const sprite = new THREE.Texture(makeSakuraPetalSprite());
  sprite.needsUpdate = true;

  material = new THREE.PointsMaterial({
    size:8, 
    map:sprite, 
    transparent:true, 
    depthWrite:false, 
    blending:THREE.AdditiveBlending, 
    opacity:0.9,
    vertexColors: true
  });

  points = new THREE.Points(geometry, material);
  scene.add(points);

  window.addEventListener('resize', onResize);
  threeContainer.addEventListener('pointermove', onPointerMove);
  threeContainer.addEventListener('pointerdown', onOrbClick);
  window.addEventListener('scroll', onParallax);

  animate();
}

function onOrbClick() {
  pulse = Math.min(4, pulse + 2);
  // Pulse the core
  if(coreLight) {
    coreLight.scale.setScalar(1.5);
  }
}

function onParallax(){
  parallax = window.scrollY * 0.02;
}

function makeSakuraPetalSprite(){
  const size = 128;
  const c = document.createElement('canvas');
  c.width = c.height = size;
  const ctx = c.getContext('2d');
  
  ctx.translate(size/2, size/2);
  
  // Draw 5-pointed sakura petal shape
  ctx.beginPath();
  for(let i = 0; i < 5; i++) {
    const angle = (i * 2 * Math.PI / 5) - Math.PI / 2;
    const x = Math.cos(angle) * size * 0.35;
    const y = Math.sin(angle) * size * 0.35;
    
    if(i === 0) {
      ctx.moveTo(x, y);
    } else {
      // Control points for petal curves
      const prevAngle = ((i-1) * 2 * Math.PI / 5) - Math.PI / 2;
      const cx1 = Math.cos(prevAngle + 0.3) * size * 0.15;
      const cy1 = Math.sin(prevAngle + 0.3) * size * 0.15;
      const cx2 = Math.cos(angle - 0.3) * size * 0.15;
      const cy2 = Math.sin(angle - 0.3) * size * 0.15;
      ctx.bezierCurveTo(cx1, cy1, cx2, cy2, x, y);
    }
  }
  ctx.closePath();
  
  // Gradient fill
  const g = ctx.createRadialGradient(0, 0, 5, 0, 0, size/2);
  g.addColorStop(0, 'rgba(255, 255, 255, 1)');
  g.addColorStop(0.3, 'rgba(255, 220, 235, 0.95)');
  g.addColorStop(0.6, 'rgba(255, 183, 213, 0.7)');
  g.addColorStop(1, 'rgba(255, 111, 145, 0)');
  ctx.fillStyle = g;
  ctx.fill();
  
  return c;
}

function updateOrbColors(isDark){
  if(!glowMesh || !colors) return;
  currentDarkMode = isDark;
  
  // Update glows and rings
  glowMesh.material.color.setHex(isDark ? 0xff6f91 : 0xffb7d5);
  glowMesh.material.opacity = isDark ? 0.08 : 0.06;
  
  coreLight.material.color.setHex(isDark ? 0xffb7d5 : 0xffdbeb);
  coreLight.material.opacity = isDark ? 0.5 : 0.6;
  
  orbitalRings.forEach(ring => {
    ring.material.color.setHex(isDark ? 0xff6f91 : 0xffb7d5);
    ring.material.opacity = isDark ? 0.12 : 0.15;
  });
  
  // Update particle colors
  for(let i=0; i<particleCount; i++){
    const colorVar = Math.random();
    if(isDark) {
      if(colorVar > 0.75) {
        colors[3*i] = 1.0; colors[3*i+1] = 0.44; colors[3*i+2] = 0.57;
      } else if(colorVar > 0.5) {
        colors[3*i] = 0.95; colors[3*i+1] = 0.35; colors[3*i+2] = 0.55;
      } else if(colorVar > 0.25) {
        colors[3*i] = 0.8; colors[3*i+1] = 0.29; colors[3*i+2] = 0.5;
      } else {
        colors[3*i] = 0.63; colors[3*i+1] = 0.29; colors[3*i+2] = 0.46;
      }
    } else {
      if(colorVar > 0.75) {
        colors[3*i] = 1.0; colors[3*i+1] = 0.95; colors[3*i+2] = 0.97;
      } else if(colorVar > 0.5) {
        colors[3*i] = 1.0; colors[3*i+1] = 0.82; colors[3*i+2] = 0.9;
      } else if(colorVar > 0.25) {
        colors[3*i] = 1.0; colors[3*i+1] = 0.65; colors[3*i+2] = 0.8;
      } else {
        colors[3*i] = 1.0; colors[3*i+1] = 0.44; colors[3*i+2] = 0.57;
      }
    }
  }
  geometry.attributes.color.needsUpdate = true;
}

function onResize(){
  const W = threeContainer.clientWidth || 480;
  const H = threeContainer.clientHeight || 480;
  camera.aspect = W/H;
  camera.updateProjectionMatrix();
  renderer.setSize(W,H);
}

function onPointerMove(e){
  const r = threeContainer.getBoundingClientRect();
  const newX = ((e.clientX - r.left) / r.width) * 2 - 1;
  const newY = -(((e.clientY - r.top) / r.height) * 2 - 1);
  
  mouseVelocity.x = newX - prevMouse.x;
  mouseVelocity.y = newY - prevMouse.y;
  
  mouse.x = newX;
  mouse.y = newY;
  prevMouse.x = newX;
  prevMouse.y = newY;
  
  rotationTarget.x = mouse.y * 0.3;
  rotationTarget.y = mouse.x * 0.3;
}

function startBreathing(){ breathingStarted = true; }

function animate(){
  t += 0.01;
  
  // Smooth rotation
  rotationVelocity.x += (rotationTarget.x - points.rotation.x) * 0.002;
  rotationVelocity.y += (rotationTarget.y - points.rotation.y) * 0.002;
  rotationVelocity.x *= 0.95;
  rotationVelocity.y *= 0.95;
  
  points.rotation.x += rotationVelocity.x + parallax * 0.01;
  points.rotation.y += rotationVelocity.y + parallax * 0.01;
  
  // Animate orbital rings in different directions
  orbitalRings.forEach((ring, idx) => {
    ring.rotation.z += (idx % 2 === 0 ? 0.002 : -0.002);
    ring.rotation.x += 0.001;
  });
  
  // Core and glow follow main rotation
  coreLight.rotation.x = points.rotation.x * 0.3;
  coreLight.rotation.y = points.rotation.y * 0.3;
  glowMesh.rotation.x = points.rotation.x * 0.5;
  glowMesh.rotation.y = points.rotation.y * 0.5;

  const baseAmp = breathingStarted ? 6 : 2;
  const spikeFactor = breathingStarted ? (1 + Math.sin(t * 1.2) * 0.2) : 1.0;

  for(let i=0;i<particleCount;i++){
    const bx = basePositions[3*i], by = basePositions[3*i+1], bz = basePositions[3*i+2];
    const ang = Math.atan2(by, bx);
    
    // Gentle wave motion
    const n = Math.sin(ang * 2 + t * 1.0) * (baseAmp * spikeFactor)
            + Math.sin((bx+by+t*4) * 0.015) * 1.5
            + (Math.sin(t * 0.7 + i*0.006) * 1);
    
    // Petal rotation
    petalAngles[i] += rotations[i];
    
    // Some petals occasionally drift
    const drift = (i % 50 === 0) ? Math.sin(t + i) * 0.3 : 0;
    
    const px = mouse.x * 20, py = mouse.y * 20;
    const dx = bx + (px * 0.04) * (1 - Math.abs(by)/220);
    const dy = by + (py * 0.04) * (1 - Math.abs(bx)/220);
    
    const targetX = bx + (n * (0.6 + pulse*0.08)) + (dx - bx) * 0.03;
    const targetY = by + (n * (0.4 + pulse*0.06)) + (dy - by) * 0.03 + drift;
    const targetZ = bz + Math.cos(t * 0.8 + i*0.007) * 1.2;
    
    velocities[3*i] += (targetX - positions[3*i]) * 0.06;
    velocities[3*i+1] += (targetY - positions[3*i+1]) * 0.06;
    velocities[3*i+2] += (targetZ - positions[3*i+2]) * 0.06;
    
    velocities[3*i] *= 0.94;
    velocities[3*i+1] *= 0.94;
    velocities[3*i+2] *= 0.94;
    
    positions[3*i] += velocities[3*i];
    positions[3*i+1] += velocities[3*i+1];
    positions[3*i+2] += velocities[3*i+2];
  }
  
  geometry.attributes.position.needsUpdate = true;
  pulse *= 0.94;
  mouseVelocity.x *= 0.9;
  mouseVelocity.y *= 0.9;

  // Breathing animation
  if(breathingStarted){
    const breath = Math.sin(t * 1.2);
    material.opacity = 0.8 + 0.15 * breath;
    material.size = 7.5 + 1.5 * (1 + breath);
    glowMesh.scale.setScalar(1 + breath * 0.06);
    coreLight.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
    coreLight.material.opacity = 0.5 + 0.2 * breath;
  } else {
    material.opacity = 0.9;
    material.size = 7.5;
  }

  points.rotation.y += 0.0006;
  glowMesh.rotation.y += 0.0004;
  coreLight.rotation.y -= 0.0008;

  renderer.render(scene, camera);
  rafID = requestAnimationFrame(animate);
}

/* initialize orb */
initOrb();
setTimeout(()=> startBreathing(), 1000);

/* ======================
   Reveal: calm expand + fade -> show hub
   ====================== */
let revealed = false;
async function revealToHub(){
  if(revealed) return;
  revealed = true;
  try{ chime.currentTime = 0; await chime.play(); } catch(e){}

  pulse = 2.4;
  const canvas = threeContainer.querySelector('canvas');

  if(canvas){
    canvas.style.transition = 'transform 760ms cubic-bezier(.2,.9,.2,1), opacity 760ms ease';
    canvas.style.transformOrigin = '50% 50%';
    canvas.style.transform = 'scale(1.06)';
    setTimeout(()=> {
      canvas.style.transform = 'scale(1.5)';
      canvas.style.opacity = '0';
      entryTitle.style.opacity = '0';
      entrySub.style.opacity = '0';
      entryOverlay.style.transition = 'opacity 760ms ease';
      entryOverlay.style.opacity = '0';
    }, 200);
  } else {
    entryOverlay.style.opacity = '0';
  }

  setTimeout(()=>{
    try{ cancelAnimationFrame(rafID); } catch(e){}
    try{ entryOverlay.remove(); } catch(e){}
    document.body.style.background = `linear-gradient(135deg, var(--zen-bg-1), var(--zen-bg-2))`;
    appRoot.classList.add('visible');
    appRoot.setAttribute('aria-hidden','false');
    loadOrInitCategories();
    checkUpdatesModal();
  }, 960);
}

entryOverlay.addEventListener('click', revealToHub);
entryOverlay.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') revealToHub(); });

/* =========================
   Updates Modal
   ========================= */
function checkUpdatesModal() {
  const seen = localStorage.getItem(UPDATES_SEEN_KEY);
  if (!seen) {
    setTimeout(() => {
      updatesModal.classList.add('show');
      updatesModal.setAttribute('aria-hidden', 'false');
    }, 800);
  }
}

closeUpdates.addEventListener('click', () => {
  updatesModal.classList.remove('show');
  updatesModal.setAttribute('aria-hidden', 'true');
  localStorage.setItem(UPDATES_SEEN_KEY, 'true');
});

/* =========================
   Categories / modal / storage
   ========================= */
let categories = null;
const defaultCats = [
  { id:'assignments', title:'Assignments', description:'Plan and manage your tasks', url:'https://wasp832.github.io/PlanneR/' },
  { id:'workouts', title:'Workouts', description:'Track your fitness journey', url:'https://wasp832.github.io/FitPro/' },
  { id:'food', title:'Food', description:'Discover and share recipes', url:'https://wasp832.github.io/FoodVibe/' }
];

const icons = {
  assignments: '<svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
  workouts: '<svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>',
  food: '<svg viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>',
  default: '<svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>'
};

async function saveCategories(){ await saveToIndexedDB(categories); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function renderCategories(list){
  cardGrid.innerHTML = '';
  list.forEach(cat => {
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.id = cat.id;
    const icon = icons[cat.id] || icons.default;
    el.innerHTML = `
      <div class="card-icon">${icon}</div>
      <div class="card-title">${escapeHtml(cat.title)}</div>
      <div class="card-desc">${escapeHtml(cat.description||'')}</div>
    `;
    el.onclick = ()=> { if(cat.url) navigateTo(cat.url); };
    cardGrid.appendChild(el);
  });
  const add = document.createElement('div');
  add.className = 'add-card';
  add.innerText = '+';
  add.onclick = openModal;
  cardGrid.appendChild(add);
}

async function loadOrInitCategories(){
  await initDB();
  categories = await loadFromIndexedDB();
  if(!categories){ categories = defaultCats.slice(); await saveCategories(); }
  renderCategories(categories);
}

function navigateTo(url){
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:white;opacity:0;z-index:9999;transition:opacity 0.6s ease';
  document.body.appendChild(overlay);
  setTimeout(()=> overlay.style.opacity = '1', 10);
  setTimeout(()=> window.location.href = url, 600);
}

/* modal actions */
openAdd.onclick = openModal;
modalCancel.onclick = closeModal;
modalSave.onclick = saveModal;
modal.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });

function openModal(){
  cardTitle.value = '';
  cardDesc.value = '';
  cardUrl.value = '';
  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
  setTimeout(()=> cardTitle.focus(), 300);
}

function closeModal(){
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
}

async function saveModal(){
  const title = cardTitle.value.trim();
  const desc = cardDesc.value.trim();
  let url = cardUrl.value.trim();
  if(!title || !desc || !url) { alert('Please fill in all fields.'); return; }
  if(!/^https?:\/\//i.test(url)) url = 'https://' + url;
  const id = title.toLowerCase().replace(/\s+/g,'_').replace(/[^\w]/g,'') || 'custom';
  if(categories.find(c=>c.id === id)){
    alert('A category with this title already exists. Please choose a different title.');
    return;
  }
  categories.push({ id, title, description: desc, url });
  await saveCategories();
  renderCategories(categories);
  closeModal();
}

/* Export Feature */
exportBtn.onclick = async () => {
  const exportData = {
    version: '2.0',
    exportDate: new Date().toISOString(),
    categories: categories,
    settings: JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}')
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `zen-hub-backup-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};

/* search */
searchInput.addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q){ renderCategories(categories); return; }
  const filtered = categories.filter(c=> 
    c.title.toLowerCase().includes(q) || 
    (c.description && c.description.toLowerCase().includes(q))
  );
  renderCategories(filtered);
});

/* theme toggle */
let darkMode = false;
themeToggle.onclick = ()=>{
  darkMode = !darkMode;
  document.body.classList.toggle('dark', darkMode);
  saveSettings();
  updatePetalColors();
  updateOrbColors(darkMode);
};

function loadSettings(){
  try{
    const s = localStorage.getItem(SETTINGS_KEY);
    if(s){
      const obj = JSON.parse(s);
      if(obj.darkMode) {
        darkMode = true;
        document.body.classList.add('dark');
      }
    }
  } catch(e){}
}

function saveSettings(){
  const obj = { darkMode };
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(obj));
}

function updatePetalColors(){
  const petals = document.querySelectorAll('.sakura-petal');
  petals.forEach(petal => {
    petal.innerHTML = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="16" cy="16" rx="15" ry="8" fill="${darkMode ? '#ff6f91' : '#ffb7d5'}"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="${darkMode ? '#a14a76' : '#ff6f91'}" opacity="0.5"/></svg>`;
  });
}

loadSettings();
updatePetalColors();
window.addEventListener('DOMContentLoaded', updatePetalColors);
</script>
</body>
</html>

