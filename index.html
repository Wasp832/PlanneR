<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Assignment Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Home View - Calendar */
        #homeView {
            background: #2d2d44;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .calendar-header h1 {
            color: #00d4ff;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .month-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .month-nav button {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
            font-weight: 600;
        }

        .month-nav button:hover {
            background: #00b8e6;
        }

        .month-nav span {
            font-size: 1.5em;
            font-weight: bold;
            color: #e0e0e0;
            min-width: 200px;
            text-align: center;
        }

        .cal-modern {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .cal-modern .day-label {
            text-align: center;
            font-weight: bold;
            color: #00d4ff;
            padding: 15px;
            font-size: 1em;
        }

        .cal-modern .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a2e;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
            font-weight: 500;
            position: relative;
            color: #e0e0e0;
        }

        .cal-modern .day:hover {
            background: #00d4ff;
            color: #1a1a2e;
            transform: scale(1.05);
        }

        .cal-modern .day.today {
            background: #ff6b6b;
            color: white;
            font-weight: bold;
        }

        .cal-modern .day.has-events::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 6px;
            height: 6px;
            background: #00d4ff;
            border-radius: 50%;
        }

        .cal-modern .day.empty {
            background: transparent;
            cursor: default;
        }

        /* View Summaries Button */
        .summaries-toggle {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        .summaries-btn {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 12px 22px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1em;
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.2);
            transition: transform 0.22s ease, background 0.2s ease;
        }

        .summaries-btn:hover { transform: translateY(-3px); background: #00b8e6; }

        /* Smooth slide / fade area */
        .summaries-panel {
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height 420ms cubic-bezier(.2,.9,.2,1), opacity 260ms ease;
            margin-top: 18px;
        }

        .summaries-panel.open {
            max-height: 1200px; /* generous height to allow slide */
            opacity: 1;
        }

        /* Week/Month View Section */
        .view-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 10px;
        }

        .view-tab {
            padding: 10px 20px;
            background: #1a1a2e;
            color: #e0e0e0;
            border: 2px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.95em;
        }

        .view-tab:hover {
            border-color: #00d4ff;
        }

        .view-tab.active {
            background: #00d4ff;
            color: #1a1a2e;
            border-color: #00d4ff;
        }

        .overview-section {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 18px;
            margin-top: 6px;
        }

        .overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .overview-header h3 {
            color: #00d4ff;
            font-size: 1.2em;
        }

        .overview-content {
            display: none;
        }

        .overview-content.active {
            display: block;
        }

        .overview-empty {
            text-align: center;
            padding: 30px 10px;
            color: #666;
        }

        .overview-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        .overview-card {
            background: #2d2d44;
            border-radius: 12px;
            padding: 16px;
            border-left: 5px solid #00d4ff;
            transition: all 0.3s;
            cursor: pointer;
        }

        .overview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .overview-card.casual { border-left-color: #4caf50; }
        .overview-card.moderate { border-left-color: #ffaa00; }
        .overview-card.important { border-left-color: #ff6b6b; }
        .overview-card.urgent { border-left-color: #ff0000; }

        .overview-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .overview-card-title h4 {
            color: #e0e0e0;
            font-size: 1.05em;
            margin-bottom: 6px;
        }

        .overview-card-title p {
            color: #aaa;
            font-size: 0.9em;
            line-height: 1.2;
        }

        .overview-card-date {
            background: rgba(0, 212, 255, 0.12);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #00d4ff;
            font-weight: bold;
            white-space: nowrap;
        }

        .overview-card-countdown {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #444;
        }

        .mini-flip {
            text-align: center;
            flex: 1;
        }

        .mini-flip-card {
            background: linear-gradient(180deg, #2d3748 50%, #1a202c 50%);
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            padding: 8px 6px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            min-width: 56px;
        }

        .mini-flip-label {
            font-size: 0.7em;
            color: #aaa;
            margin-top: 6px;
        }

        /* Day View (kept unchanged) */
        #dayView {
            display: none;
            background: #2d2d44;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            min-height: 90vh;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #444;
        }

        .back-btn {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
            font-weight: 600;
        }

        .back-btn:hover { background: #00b8e6; }

        .day-title { flex: 1; text-align: center; }

        .day-title h2 { color: #00d4ff; font-size: 2em; }
        .day-title p { color: #aaa; margin-top: 5px; }

        /* Timer Section */
        .timer-section {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #444;
        }

        .timer-section.urgent {
            background: linear-gradient(135deg, #8b0000 0%, #ff4444 100%);
            animation: pulse 2s infinite;
        }

        .timer-section.warning { background: linear-gradient(135deg, #ff8800 0%, #ffaa00 100%); }

        @keyframes pulse { 0%,100%{ opacity: 1 } 50% { opacity: 0.8 } }

        .timer-flip { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }

        .flip-unit { text-align: center; }

        .flip-card {
            background: linear-gradient(180deg, #2d3748 50%, #1a202c 50%);
            color: white;
            font-size: 3em;
            font-weight: bold;
            padding: 20px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            min-width: 90px;
        }

        .flip-label { font-size: 0.9em; color: white; margin-top: 8px; opacity: 0.9; }

        .timer-progress { width: 100%; }
        .progress-bar { width: 100%; height: 50px; background: rgba(255,255,255,0.1); border-radius: 25px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: #00d4ff; transition: width 1s linear, background 0.3s; display: flex; align-items: center; justify-content: flex-end; padding-right: 20px; color: #1a1a2e; font-weight: bold; font-size: 1.2em; }
        .progress-fill.urgent { background: #ff4444; color: white; }
        .progress-fill.warning { background: #ffaa00; color: #1a1a2e; }

        /* Events Section */
        .events-section { margin-top: 30px; }
        .events-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .events-header h3 { color: #e0e0e0; font-size: 1.8em; }
        .add-event-btn {
            background: #00d4ff; color: #1a1a2e; border: none; width: 50px; height: 50px; border-radius: 50%;
            font-size: 2em; cursor: pointer; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4); font-weight:bold;
        }
        .add-event-btn:hover { background: #00b8e6; transform: scale(1.1); }

        .no-events { text-align: center; padding: 60px 20px; color: #666; }
        .no-events-icon { font-size: 4em; margin-bottom: 20px; }

        .events-list { display:flex; flex-direction: column; gap: 15px; }
        .event-card {
            background: #1a1a2e; color: white; padding: 20px 25px; border-radius: 12px;
            display:flex; justify-content: space-between; align-items: center; cursor:pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-left: 5px solid #00d4ff;
        }
        .event-card.casual { border-left-color: #4caf50; }
        .event-card.moderate { border-left-color: #ffaa00; }
        .event-card.important { border-left-color: #ff6b6b; }
        .event-card.urgent { border-left-color: #ff0000; background: linear-gradient(135deg, #1a1a2e 0%, #3d0000 100%); }
        .event-card:hover { transform: translateX(10px); box-shadow: 0 6px 20px rgba(0,0,0,0.4); }

        .event-info h4 { font-size: 1.3em; margin-bottom: 5px; }
        .event-info p { opacity: 0.9; font-size: 0.95em; }
        .event-time { font-size: 1.1em; font-weight:bold; opacity: 0.95; }

        /* Event Detail View */
        #eventDetailView { display: none; background: #2d2d44; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); max-width: 800px; margin: 0 auto; }
        .detail-header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #444; }
        .detail-content { padding: 20px 0; }
        .detail-item { margin-bottom: 25px; }
        .detail-item label { display:block; color:#00d4ff; font-weight:bold; margin-bottom:8px; font-size:1.1em; }
        .detail-item p { color:#e0e0e0; font-size:1.1em; line-height:1.6; }
        .detail-actions { display:flex; gap:15px; margin-top:30px; }
        .edit-btn, .delete-btn { flex:1; padding:15px; border:none; border-radius:8px; font-size:1.1em; cursor:pointer; transition: all 0.3s; font-weight:600; }
        .edit-btn { background: #00d4ff; color:#1a1a2e; }
        .edit-btn:hover { background:#00b8e6; }
        .delete-btn { background:#ff4444; color:white; }
        .delete-btn:hover { background:#cc0000; }

        /* Modal */
        .modal { display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index:1000; overflow-y:auto; padding:20px; }
        .modal-content { background:#2d2d44; max-width:600px; margin:50px auto; padding:40px; border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,0.6); }
        .modal-header { display:flex; justify-content: space-between; align-items:center; margin-bottom:30px; padding-bottom:20px; border-bottom:2px solid #444; }
        .modal-header h2 { color:#00d4ff; font-size:2em; }
        .close-btn { background:none; border:none; color:#999; font-size:2em; cursor:pointer; transition:color 0.3s; }
        .close-btn:hover { color:#ff4444; }
        .form-group { margin-bottom:25px; }
        .form-group label { display:block; color:#00d4ff; font-weight:bold; margin-bottom:10px; font-size:1.1em; }
        .form-group input, .form-group textarea, .form-group select {
            width:100%; padding:15px; background:#1a1a2e; border:2px solid #444; border-radius:8px; color:#e0e0e0; font-size:1em; font-family:inherit;
        }
        .form-group textarea { resize:vertical; min-height:100px; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline:none; border-color:#00d4ff; }
        .priority-options { display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
        .priority-option { padding:15px; border:2px solid #444; border-radius:8px; cursor:pointer; text-align:center; transition:all 0.3s; color:#e0e0e0; font-weight:600; }
        .priority-option:hover { border-color:#00d4ff; }
        .priority-option.selected { border-width:3px; }
        .priority-option.casual.selected { background:#4caf50; border-color:#4caf50; color:white; }
        .priority-option.moderate.selected { background:#ffaa00; border-color:#ffaa00; color:#1a1a2e; }
        .priority-option.important.selected { background:#ff6b6b; border-color:#ff6b6b; color:white; }
        .priority-option.urgent.selected { background:#ff0000; border-color:#ff0000; color:white; }
        .form-actions { display:flex; gap:15px; margin-top:30px; }
        .submit-btn, .cancel-btn { flex:1; padding:15px; border:none; border-radius:8px; font-size:1.1em; cursor:pointer; transition: all 0.3s; font-weight:600; }
        .submit-btn { background:#00d4ff; color:#1a1a2e; }
        .submit-btn:hover { background:#00b8e6; }
        .cancel-btn { background:#444; color:#e0e0e0; }
        .cancel-btn:hover { background:#555; }

        /* Responsive tweak */
        @media (max-width: 640px) {
            .cal-modern { grid-template-columns: repeat(7, 1fr); gap: 6px; }
            .month-nav span { min-width: 140px; font-size:1.1em; }
            .overview-list { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; }
            .mini-flip-card { font-size: 1.05em; min-width: 48px; padding: 6px 6px; }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Home View with Calendar -->
        <div id="homeView">
            <div class="calendar-header">
                <h1>📚 Assignment Planner</h1>
                <div class="month-nav">
                    <button onclick="changeMonth(-1)">← Prev</button>
                    <span id="currentMonth">October 2025</span>
                    <button onclick="changeMonth(1)">Next →</button>
                </div>
            </div>
            <div class="cal-modern" id="calendar"></div>

            <!-- View Summaries Button -->
            <div class="summaries-toggle">
                <button id="summariesBtn" class="summaries-btn" onclick="toggleSummaries()">
                    View Summaries
                </button>
            </div>

            <!-- Summaries Panel (hidden by default) -->
            <div id="summariesPanel" class="summaries-panel" aria-hidden="true">
                <div class="view-tabs" role="tablist" aria-label="Summary tabs">
                    <div class="view-tab active" data-type="week" onclick="switchSummaryTab('week')">Weekly Summary</div>
                    <div class="view-tab" data-type="month" onclick="switchSummaryTab('month')">Monthly Summary</div>
                </div>

                <div class="overview-section">
                    <div id="weekSummary" class="overview-content active">
                        <div id="weekAssignments" class="overview-list"></div>
                    </div>
                    <div id="monthSummary" class="overview-content">
                        <div id="monthAssignments" class="overview-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Day View -->
        <div id="dayView">
            <div class="day-header">
                <button class="back-btn" onclick="showHomeView()">← Back to Calendar</button>
                <div class="day-title">
                    <h2 id="selectedDayTitle">Monday, October 8</h2>
                    <p id="selectedDayDate">2025</p>
                </div>
                <div style="width: 120px;"></div>
            </div>

            <!-- Timer Section -->
            <div class="timer-section" id="timerSection">
                <div class="timer-flip">
                    <div class="flip-unit">
                        <div class="flip-card" id="flipDays">00</div>
                        <div class="flip-label">Days</div>
                    </div>
                    <div class="flip-unit">
                        <div class="flip-card" id="flipHours">00</div>
                        <div class="flip-label">Hours</div>
                    </div>
                    <div class="flip-unit">
                        <div class="flip-card" id="flipMinutes">00</div>
                        <div class="flip-label">Minutes</div>
                    </div>
                    <div class="flip-unit">
                        <div class="flip-card" id="flipSeconds">00</div>
                        <div class="flip-label">Seconds</div>
                    </div>
                </div>
                <div class="timer-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%">
                            <span id="progressText">No deadline set</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events Section -->
            <div class="events-section">
                <div class="events-header">
                    <h3>Today's Assignments</h3>
                    <button class="add-event-btn" onclick="openAddModal()">+</button>
                </div>
                <div id="eventsContainer"></div>
            </div>
        </div>

        <!-- Event Detail View -->
        <div id="eventDetailView">
            <div class="detail-header">
                <button class="back-btn" onclick="showDayView()">← Back to Day</button>
                <h2 style="color: #00d4ff; flex: 1; text-align: center;">Assignment Details</h2>
                <div style="width: 120px;"></div>
            </div>
            <div class="detail-content" id="eventDetailContent"></div>
        </div>
    </div>

    <!-- Add/Edit Event Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Assignment</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="eventForm">
                <div class="form-group">
                    <label for="unitInput">Unit/Course *</label>
                    <input type="text" id="unitInput" required placeholder="e.g., Mathematics 101">
                </div>

                <div class="form-group">
                    <label for="whereInput">Where to Get Assignment *</label>
                    <input type="text" id="whereInput" required placeholder="e.g., Online portal, Professor's office">
                </div>

                <div class="form-group">
                    <label for="dueDateInput">Due Date *</label>
                    <input type="date" id="dueDateInput" required>
                </div>

                <div class="form-group">
                    <label for="dueTimeInput">Due Time *</label>
                    <input type="time" id="dueTimeInput" required>
                </div>

                <div class="form-group">
                    <label for="materialsInput">Materials Needed</label>
                    <textarea id="materialsInput" placeholder="List any materials or resources needed..."></textarea>
                </div>

                <div class="form-group">
                    <label for="descriptionInput">Additional Notes</label>
                    <textarea id="descriptionInput" placeholder="Any additional details..."></textarea>
                </div>

                <div class="form-group">
                    <label>Priority Level *</label>
                    <div class="priority-options">
                        <div class="priority-option casual" onclick="selectPriority('casual')">
                            🟢 Casual
                        </div>
                        <div class="priority-option moderate" onclick="selectPriority('moderate')">
                            🟡 Moderate
                        </div>
                        <div class="priority-option important" onclick="selectPriority('important')">
                            🟠 Important
                        </div>
                        <div class="priority-option urgent" onclick="selectPriority('urgent')">
                            🔴 Urgent
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Save Assignment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage with persistence
        let events = {};
        let currentDate = new Date();
        let selectedDate = null;
        let countdownInterval = null;
        let editingEventId = null;
        let selectedPriority = 'casual';

        // Summary countdown interval
        let summariesInterval = null;
        let summariesVisible = false;
        let activeSummaryTab = 'week';

        // Load events from memory on startup (using window.eventsData as simple persistence)
        function loadEvents() {
            const saved = window.eventsData;
            if (saved) {
                events = saved;
            }
        }

        // Save events to memory
        function saveEvents() {
            window.eventsData = events;
            // If summaries are visible, re-render so cards update when events change
            if (summariesVisible) renderSummaries(activeSummaryTab);
        }

        // Calendar functions
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(d => {
                const label = document.createElement('div');
                label.className = 'day-label';
                label.textContent = d;
                calendar.appendChild(label);
            });

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                calendar.appendChild(emptyDay);
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'day';
                day.textContent = i;

                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;

                if (events[dateKey] && events[dateKey].length > 0) {
                    day.classList.add('has-events');
                }

                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    day.classList.add('today');
                }

                day.onclick = () => showDayView(i, month, year);
                calendar.appendChild(day);
            }

            updateMonthDisplay();
        }

        function updateMonthDisplay() {
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent =
                `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // View navigation
        function showHomeView() {
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('dayView').style.display = 'none';
            document.getElementById('eventDetailView').style.display = 'none';
            stopCountdown();
        }

        function showDayView(day, month, year) {
            if (day === undefined) {
                // Called from back button, use current selectedDate
                const parts = selectedDate.split('-');
                year = parseInt(parts[0]);
                month = parseInt(parts[1]) - 1;
                day = parseInt(parts[2]);
            } else {
                selectedDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            }

            const date = new Date(year, month, day);
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];

            document.getElementById('selectedDayTitle').textContent =
                `${dayNames[date.getDay()]}, ${monthNames[month]} ${day}`;
            document.getElementById('selectedDayDate').textContent = year;

            renderEvents();
            startCountdown();

            document.getElementById('homeView').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            document.getElementById('eventDetailView').style.display = 'none';
        }

        function renderEvents() {
            const container = document.getElementById('eventsContainer');
            const dayEvents = events[selectedDate] || [];

            if (dayEvents.length === 0) {
                container.innerHTML = `
                    <div class="no-events">
                        <div class="no-events-icon">📭</div>
                        <p>No assignments scheduled for this day</p>
                        <p style="margin-top: 10px; color: #666;">Click the + button to add an assignment</p>
                    </div>
                `;
            } else {
                container.innerHTML = '<div class="events-list"></div>';
                const eventsList = container.querySelector('.events-list');

                // Sort events by due time
                dayEvents.sort((a, b) => {
                    const timeA = a.dueTime || '00:00';
                    const timeB = b.dueTime || '00:00';
                    return timeA.localeCompare(timeB);
                });

                dayEvents.forEach(event => {
                    const card = document.createElement('div');
                    card.className = `event-card ${event.priority}`;
                    card.onclick = () => showEventDetail(event);

                    const time = event.dueTime ? formatTime(event.dueTime) : 'No time set';

                    card.innerHTML = `
                        <div class="event-info">
                            <h4>${event.unit}</h4>
                            <p>${event.where}</p>
                        </div>
                        <div class="event-time">${time}</div>
                    `;
                    eventsList.appendChild(card);
                });
            }
        }

        function formatTime(time24) {
            const [hours, minutes] = time24.split(':');
            const h = parseInt(hours);
            const ampm = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            return `${h12}:${minutes} ${ampm}`;
        }

        function showEventDetail(event) {
            const content = document.getElementById('eventDetailContent');
            const time = event.dueTime ? formatTime(event.dueTime) : 'No time set';

            const priorityLabels = {
                casual: '🟢 Casual',
                moderate: '🟡 Moderate',
                important: '🟠 Important',
                urgent: '🔴 Urgent'
            };

            content.innerHTML = `
                <div class="detail-item">
                    <label>Unit/Course</label>
                    <p>${event.unit}</p>
                </div>
                <div class="detail-item">
                    <label>Where to Get Assignment</label>
                    <p>${event.where}</p>
                </div>
                <div class="detail-item">
                    <label>Due Date & Time</label>
                    <p>${event.dueDate} at ${time}</p>
                </div>
                <div class="detail-item">
                    <label>Materials Needed</label>
                    <p>${event.materials || 'None specified'}</p>
                </div>
                <div class="detail-item">
                    <label>Additional Notes</label>
                    <p>${event.description || 'No additional notes'}</p>
                </div>
                <div class="detail-item">
                    <label>Priority Level</label>
                    <p>${priorityLabels[event.priority]}</p>
                </div>
                <div class="detail-actions">
                    <button class="edit-btn" onclick="editEvent(${event.id})">Edit Assignment</button>
                    <button class="delete-btn" onclick="deleteEvent(${event.id})">Delete Assignment</button>
                </div>
            `;

            document.getElementById('dayView').style.display = 'none';
            document.getElementById('eventDetailView').style.display = 'block';
        }

        // Modal functions
        function openAddModal() {
            editingEventId = null;
            document.getElementById('modalTitle').textContent = 'Add Assignment';
            document.getElementById('eventForm').reset();
            selectedPriority = 'casual';
            updatePrioritySelection();

            // Set default date to selected date if present, otherwise today
            const defaultDate = selectedDate || new Date().toISOString().slice(0,10);
            document.getElementById('dueDateInput').value = defaultDate;

            document.getElementById('eventModal').style.display = 'block';
        }

        function editEvent(eventId) {
            const dayEvents = events[selectedDate] || [];
            const event = dayEvents.find(e => e.id === eventId);

            if (!event) return;

            editingEventId = eventId;
            document.getElementById('modalTitle').textContent = 'Edit Assignment';
            document.getElementById('unitInput').value = event.unit;
            document.getElementById('whereInput').value = event.where;
            document.getElementById('dueDateInput').value = event.dueDate;
            document.getElementById('dueTimeInput').value = event.dueTime;
            document.getElementById('materialsInput').value = event.materials || '';
            document.getElementById('descriptionInput').value = event.description || '';
            selectedPriority = event.priority;
            updatePrioritySelection();

            document.getElementById('eventModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('eventModal').style.display = 'none';
            editingEventId = null;
        }

        function selectPriority(priority) {
            selectedPriority = priority;
            updatePrioritySelection();
        }

        function updatePrioritySelection() {
            document.querySelectorAll('.priority-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            const el = document.querySelector(`.priority-option.${selectedPriority}`);
            if (el) el.classList.add('selected');
        }

        // Event form submission
        document.getElementById('eventForm').onsubmit = function(e) {
            e.preventDefault();

            const unit = document.getElementById('unitInput').value;
            const where = document.getElementById('whereInput').value;
            const dueDate = document.getElementById('dueDateInput').value;
            const dueTime = document.getElementById('dueTimeInput').value;
            const materials = document.getElementById('materialsInput').value;
            const description = document.getElementById('descriptionInput').value;

            if (editingEventId !== null) {
                // Edit existing event
                // Find the event among all dates (because selectedDate may have changed)
                let found = false;
                for (let key in events) {
                    const idx = events[key].findIndex(e => e.id === editingEventId);
                    if (idx !== -1) {
                        const old = events[key][idx];
                        // Remove from old date if date changed
                        events[key].splice(idx, 1);
                        if (events[key].length === 0) delete events[key];

                        const targetDate = dueDate;
                        if (!events[targetDate]) events[targetDate] = [];
                        events[targetDate].push({
                            id: editingEventId,
                            unit, where, dueDate, dueTime, materials, description,
                            priority: selectedPriority
                        });
                        selectedDate = dueDate;
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    // fallback: create new event
                    const newEvent = {
                        id: editingEventId,
                        unit, where, dueDate, dueTime, materials, description,
                        priority: selectedPriority
                    };
                    if (!events[dueDate]) events[dueDate] = [];
                    events[dueDate].push(newEvent);
                    selectedDate = dueDate;
                }
            } else {
                // Add new event
                const newEvent = {
                    id: Date.now(),
                    unit, where, dueDate, dueTime, materials, description,
                    priority: selectedPriority
                };

                if (!events[dueDate]) events[dueDate] = [];
                events[dueDate].push(newEvent);

                selectedDate = dueDate;
            }

            saveEvents();
            closeModal();
            renderCalendar();

            // Extract date parts from dueDate string and open day view
            const [year, month, day] = dueDate.split('-');
            showDayView(parseInt(day), parseInt(month) - 1, parseInt(year));
        };

        function deleteEvent(eventId) {
            if (!confirm('Are you sure you want to delete this assignment?')) return;

            // Find and delete
            for (let key in events) {
                const idx = events[key].findIndex(e => e.id === eventId);
                if (idx !== -1) {
                    events[key].splice(idx, 1);
                    if (events[key].length === 0) delete events[key];
                    break;
                }
            }
            saveEvents();
            renderCalendar();
            // If viewing a day, refresh
            if (selectedDate) showDayView();
        }

        // Countdown timer functions (for Day view)
        function pad(n) { return n.toString().padStart(2, '0'); }

        function getNextDeadline() {
            const dayEvents = events[selectedDate] || [];
            if (dayEvents.length === 0) return null;

            // Find the earliest deadline (that has time)
            let earliest = null;
            dayEvents.forEach(event => {
                if (event.dueDate && event.dueTime) {
                    const deadlineStr = `${event.dueDate}T${event.dueTime}`;
                    const deadline = new Date(deadlineStr);

                    if (!earliest || deadline < earliest.deadline) {
                        earliest = { deadline, event };
                    }
                }
            });

            return earliest;
        }

        function updateCountdown() {
            const nextDeadline = getNextDeadline();

            if (!nextDeadline) {
                document.getElementById('flipDays').textContent = '00';
                document.getElementById('flipHours').textContent = '00';
                document.getElementById('flipMinutes').textContent = '00';
                document.getElementById('flipSeconds').textContent = '00';
                document.getElementById('progressText').textContent = 'No deadline set';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('timerSection').className = 'timer-section';
                document.getElementById('progressFill').className = 'progress-fill';
                return;
            }

            const now = new Date();
            const diff = nextDeadline.deadline - now;

            if (diff <= 0) {
                document.getElementById('flipDays').textContent = '00';
                document.getElementById('flipHours').textContent = '00';
                document.getElementById('flipMinutes').textContent = '00';
                document.getElementById('flipSeconds').textContent = '00';
                document.getElementById('progressText').textContent = 'OVERDUE!';
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('timerSection').className = 'timer-section urgent';
                document.getElementById('progressFill').className = 'progress-fill urgent';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('flipDays').textContent = pad(days);
            document.getElementById('flipHours').textContent = pad(hours);
            document.getElementById('flipMinutes').textContent = pad(minutes);
            document.getElementById('flipSeconds').textContent = pad(seconds);

            // Calculate progress (assuming 7 days as max)
            const totalSeconds = diff / 1000;
            const maxSeconds = 7 * 24 * 60 * 60;
            const percent = Math.max(0, ((maxSeconds - totalSeconds) / maxSeconds) * 100);

            document.getElementById('progressFill').style.width = Math.min(percent, 100) + '%';
            document.getElementById('progressText').textContent = `${days}d ${hours}h ${minutes}m`;

            // Update styling based on urgency
            const timerSection = document.getElementById('timerSection');
            const progressFill = document.getElementById('progressFill');

            if (days === 0 && hours < 6) {
                timerSection.className = 'timer-section urgent';
                progressFill.className = 'progress-fill urgent';
            } else if (days === 0) {
                timerSection.className = 'timer-section warning';
                progressFill.className = 'progress-fill warning';
            } else if (days <= 1) {
                timerSection.className = 'timer-section warning';
                progressFill.className = 'progress-fill warning';
            } else {
                timerSection.className = 'timer-section';
                progressFill.className = 'progress-fill';
            }
        }

        function startCountdown() {
            stopCountdown();
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function stopCountdown() {
            if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
        }

        // Summaries: toggling and rendering
        function toggleSummaries() {
            const panel = document.getElementById('summariesPanel');
            const btn = document.getElementById('summariesBtn');

            summariesVisible = !summariesVisible;
            if (summariesVisible) {
                panel.classList.add('open');
                panel.setAttribute('aria-hidden', 'false');
                btn.textContent = 'Hide Summaries';
                renderSummaries(activeSummaryTab);
                startSummariesCountdown();
                // Scroll into view smoothly so user sees it
                setTimeout(() => panel.scrollIntoView({ behavior: 'smooth', block: 'start' }), 180);
            } else {
                panel.classList.remove('open');
                panel.setAttribute('aria-hidden', 'true');
                btn.textContent = 'View Summaries';
                stopSummariesCountdown();
            }
        }

        function switchSummaryTab(type) {
            activeSummaryTab = type;
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-type') === type);
            });
            document.querySelectorAll('.overview-content').forEach(c => {
                c.classList.remove('active');
            });
            document.getElementById(type + 'Summary').classList.add('active');

            if (summariesVisible) renderSummaries(type);
        }

        function renderSummaries(type) {
            const now = new Date();
            // weekStart: Sunday of current week
            const weekStart = new Date(now);
            weekStart.setHours(0,0,0,0);
            weekStart.setDate(now.getDate() - now.getDay());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            weekEnd.setHours(23,59,59,999);

            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999);

            const targetDiv = document.getElementById(type === 'week' ? 'weekAssignments' : 'monthAssignments');
            targetDiv.innerHTML = '';

            const list = [];

            for (let key in events) {
                const eventDate = new Date(key + 'T00:00:00');
                const isInWeek = eventDate >= weekStart && eventDate <= weekEnd;
                const isInMonth = (eventDate.getMonth() === now.getMonth() && eventDate.getFullYear() === now.getFullYear());

                if ((type === 'week' && isInWeek) || (type === 'month' && isInMonth)) {
                    events[key].forEach(ev => list.push(Object.assign({}, ev, { date: key })));
                }
            }

            if (list.length === 0) {
                targetDiv.innerHTML = `<div class="overview-empty">No ${type} assignments found 📭</div>`;
                return;
            }

            // sort by absolute due datetime (if dueTime missing, assume start of day)
            list.sort((a, b) => {
                const aDt = new Date(`${a.date}T${a.dueTime || '00:00'}`);
                const bDt = new Date(`${b.date}T${b.dueTime || '00:00'}`);
                return aDt - bDt;
            });

            list.forEach(ev => {
                const due = new Date(`${ev.date}T${ev.dueTime || '00:00'}`);
                const card = document.createElement('div');
                card.className = `overview-card ${ev.priority}`;
                // create unique id for countdown container so updates can find it
                const uid = `s-${ev.id}-${ev.date.replace(/-/g,'')}`;
                const dueLabel = (ev.dueTime ? `${new Date(ev.date).toDateString()} • ${formatTime(ev.dueTime)}` : new Date(ev.date).toDateString());

                card.innerHTML = `
                    <div class="overview-card-header">
                        <div class="overview-card-title">
                            <h4>${escapeHtml(ev.unit)}</h4>
                            <p>${escapeHtml(ev.description || ev.where || 'No details provided')}</p>
                        </div>
                        <div class="overview-card-date">${dueLabel}</div>
                    </div>
                    <div class="overview-card-countdown" data-deadline="${due.toISOString()}" id="${uid}">
                        <div class="mini-flip">
                            <div class="mini-flip-card" data-part="days">--</div>
                            <div class="mini-flip-label">Days</div>
                        </div>
                        <div class="mini-flip">
                            <div class="mini-flip-card" data-part="hours">--</div>
                            <div class="mini-flip-label">Hours</div>
                        </div>
                        <div class="mini-flip">
                            <div class="mini-flip-card" data-part="minutes">--</div>
                            <div class="mini-flip-label">Minutes</div>
                        </div>
                        <div class="mini-flip">
                            <div class="mini-flip-card" data-part="seconds">--</div>
                            <div class="mini-flip-label">Seconds</div>
                        </div>
                    </div>
                `;
                // clicking card shows details
                card.onclick = () => {
                    selectedDate = ev.date;
                    showEventDetail(ev);
                };
                targetDiv.appendChild(card);
            });

            // Immediately update countdowns once
            updateSummariesCountdown();
        }

        function startSummariesCountdown() {
            stopSummariesCountdown();
            summariesInterval = setInterval(updateSummariesCountdown, 1000);
        }

        function stopSummariesCountdown() {
            if (summariesInterval) { clearInterval(summariesInterval); summariesInterval = null; }
        }

        function updateSummariesCountdown() {
            // find all countdown containers inside the currently visible summary
            const activeContainer = document.querySelector('.overview-content.active');
            if (!activeContainer) return;
            const countdowns = activeContainer.querySelectorAll('[data-deadline]');
            const now = new Date();

            countdowns.forEach(node => {
                const deadlineStr = node.getAttribute('data-deadline');
                const deadline = new Date(deadlineStr);
                const parts = node.querySelectorAll('.mini-flip-card');

                if (isNaN(deadline)) {
                    parts.forEach(p => p.textContent = '--');
                    return;
                }

                let diff = Math.max(0, deadline - now);
                if (diff <= 0) {
                    // overdue
                    parts[0].textContent = '00';
                    parts[1].textContent = '00';
                    parts[2].textContent = '00';
                    parts[3].textContent = '00';
                    // optionally style overdue card (add class)
                    const card = node.closest('.overview-card');
                    if (card && !card.classList.contains('overdue')) card.classList.add('overdue');
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                diff -= days * (1000 * 60 * 60 * 24);
                const hours = Math.floor(diff / (1000 * 60 * 60));
                diff -= hours * (1000 * 60 * 60);
                const minutes = Math.floor(diff / (1000 * 60));
                diff -= minutes * (1000 * 60);
                const seconds = Math.floor(diff / 1000);

                // update parts (Days / Hours / Minutes / Seconds)
                const findBy = (part) => node.querySelector(`[data-part="${part}"]`);
                if (findBy('days')) findBy('days').textContent = String(days).padStart(2, '0');
                if (findBy('hours')) findBy('hours').textContent = String(hours).padStart(2, '0');
                if (findBy('minutes')) findBy('minutes').textContent = String(minutes).padStart(2, '0');
                if (findBy('seconds')) findBy('seconds').textContent = String(seconds).padStart(2, '0');
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('eventModal');
            if (event.target === modal) { closeModal(); }
        };

        // Small helper to escape HTML in strings inserted into card text
        function escapeHtml(str) {
            if (!str && str !== 0) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Initialize
        loadEvents();
        renderCalendar();

        // If any events exist in the current visible week at load and user toggles summaries later, render will pick them up.
        // Expose renderSummaries to be called externally if needed.
        window.renderSummaries = renderSummaries;

    </script>
</body>
</html>
